<form class="desktop-view">
  <div class = "sm-preform">
    <div class = "sm-preform-left">
      <div class="sm-preform-left-title">Update your address with <span style="font-weight: bold;">hundreds</span> of businesses at once </div>
      <div class="sm-preform-left-content">The award-winning change of service</div>
      <div class = "sm-preform-input-email-padding">
        <input class="sm-preform__input sm-preform-input-email-width" placeholder = "Your email" type="email" name="smfEmail" required />
      </div>
      <div class = "sm-preform-left-inputs">
        <div>
          <input
          class="sm-preform__input sm-preform__postcodeFrom sm-preform-input-postcode-width"
          type="text"
          placeholder = "Moving from"
          name="smfPostCodeFrom"
          required
          />
          <p class="error postcodeFrom-error"></p>
        </div>
        <div>
          <input
          class="sm-preform__input sm-preform__postcodeTo sm-preform-input-postcode-width"
          id = "sm-preform__postCodeTo"
          type="text"
          name="smfPostCode"
          placeholder = "Moving to"
          required
          />
          <p class="error postcodeTo-error"></p>
        </div>
      </div>
      <div class = "sm-preform-address-set">
      <div class="addressesFromSet" id = "addressesFromSet">
      </div>
      <div class="addressesToSet" id = "addressesToSet">
      </div>
      </div>
      <div class = "sm-preform-left-buttons">
        <div>
          <div class="sm-preform-left-buttons-trustpilot">
            <div >
            <img class="sm-preform-left-buttons-trustpilot-icon" alt="Trustpilot" width="80" height="18" data-src="https://cdn.anyvan.com/images/trustpilot2021/brandmark_gr-blk.svg?v=327b66faf217f9259e3f51f0d2fe62bb2013cc0a" src="https://cdn.anyvan.com/images/trustpilot2021/brandmark_gr-blk.svg?v=327b66faf217f9259e3f51f0d2fe62bb2013cc0a">
            </div>
            <div class="sm-preform-left-buttons-trustpilot-content">
            </div>
          </div>
          <div>
            <img class="lozad" src="https://cdn.trustpilot.net/brand-assets/4.1.0/stars/stars-4.5.svg" 
            alt="Trustpilot" width="125" data-loaded="true">
          </div>
        </div>
        <button class="sm-preform__submit" type="submit">Update my address &nbsp;❯</button>
      </div>
      <div class="sm-preform-enter-address-manually-part">
          <div class="sm-preform-enter-address-manually-button" onclick="enterAddressManuallyButtonClick()">Enter address manually</div>
          <div class="sm-preform-use-address-finder-button" onclick="useAddressFinderButtonClick()">Use address finder</div>
      </div>
    </div>
    <div class = "sm-preform-right">
      <img
      style="height: 350px; width: 90%; object-fit: contain;"
      src="https://slothmove.com/wp-content/uploads/2021/10/SlothMove-Address.png"
      />
    </div>
  </div> 
</form>
<form class="mobile-view">
  <div class = "sm-preform-mobile">
    <div class = "sm-preform-mobile-logo">
      <img
      style="height: 280px; width: 90%; object-fit: contain;"
      src="https://slothmove.com/wp-content/uploads/2021/10/SlothMove-Address.png"
      />
    </div>
    <div class="sm-preform-mobile-title">Update your address with <span style="font-weight: bold;">hundreds</span> of businesses at once</div>
    <div class="sm-preform-mobile-content">The award-winning change of address service</div>
    <div class = "sm-preform-mobile-input">
      <input class="sm-preform__input sm-preform-mobile-email-input-width" placeholder = "Your email" type="email" name="smfEmailMobile" />
    </div>
    <div class = "sm-preform-mobile-input">
      <input
      class="sm-preform__input sm-preform__postcodeFrom__mobile sm-preform-mobile-email-input-width"
      type="text"
      placeholder = "Moving from"
      name="smfPostCodeFrom"
      />
      <p class="error postcodeFrom-error-mobile"></p>
    </div>
    <div class="addressesFromSet-mobile" id = "addressesFromSet-mobile">
    </div>
    <div class = "sm-preform-mobile-input">
      <input
      class="sm-preform__input sm-preform__postcodeTo__mobile sm-preform-mobile-email-input-width"
      type="text"
      name="smfPostCode"
      placeholder = "Moving to"
      />
      <p class="error postcodeTo-error-mobile"></p>
    </div>
    <div class="addressesToSet-mobile" id = "addressesToSet-mobile">
    </div>
    <div>
      <button class="sm-preform__submit-mobile" type="submit">Update my address &nbsp;❯</button>
    </div>
    <div class="sm-preform-enter-address-manually-part-mobile">
        <div class="sm-preform-enter-address-manually-button-mobile" onclick="enterAddressManuallyMobileButtonClick()">Enter address manually</div>
        <div class="sm-preform-use-address-finder-button-mobile" onclick="useAddressFinderMobileButtonClick()">Use address finder</div>
    </div>
    <div class="sm-preform-trustpilot-mobile">
      <div class="sm-preform-trustpilot-mobile-width">
        <div class="sm-preform-left-buttons-trustpilot">
          <div >
          <img class="sm-preform-left-buttons-trustpilot-icon" alt="Trustpilot" width="90" height="20" data-src="https://cdn.anyvan.com/images/trustpilot2021/brandmark_gr-blk.svg?v=327b66faf217f9259e3f51f0d2fe62bb2013cc0a" src="https://cdn.anyvan.com/images/trustpilot2021/brandmark_gr-blk.svg?v=327b66faf217f9259e3f51f0d2fe62bb2013cc0a">
          </div>
          <div class="sm-preform-left-buttons-trustpilot-content-mobile">
          </div>
        </div>
        <div>
          <img class="lozad" src="https://cdn.trustpilot.net/brand-assets/4.1.0/stars/stars-4.5.svg" 
          alt="Trustpilot" width="175" data-loaded="true">
        </div>
      </div>
    </div>
  </div> 
</div> 
</form>
<script type="text/javascript">
  window.smfSelectedAddresses = [];
  var setupListener = function() {
    addressNow.listen("load", function(control) {
      control.listen("populate", function(address) {
        window.smfSelectedAddresses.push(
          address.Label.split("\n").join(", ")
        );
      });
    });
  };

  function uuidv4() {
    return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, function(c) {
      return ( c ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (c / 4)))).toString(16);
    });
  }

  function show_spinner(postcode){
    document.querySelector(".smf-loading-tariffs").innerHTML = `Loading addresses for ${postcode}...`
    document.querySelector(".suppliers-loading-pre").style.display = "flex";
  }

  function hide_spinner(){
    document.querySelector(".suppliers-loading-pre").style.display = "none";
  }

  let postcodeTo = "";
  let addressesTo = [];
  let show_addressesTo = false;    
  let postcodeTo_error = "";
  let address_loading = false;
  let manual_addressTo = false;
  let valid_postcodeTo = false;
  let outcode = "";
  let new_addressTo = "";
  let automatic_addressTo = false;
  var manualTo = false
  let postcodeFrom = "";
  let addressesFrom = [];
  let show_addressesFrom = false;    
  let postcodeFrom_error = "";
  let manual_addressFrom = false;
  let valid_postcodeFrom = false;
  let new_addressFrom  = "";
  let automatic_addressFrom = false;
  let inputFromAddressFlag = false;
  let inputFromAddressFirstFlag = false;
  let fromAddressSt = 0, fromAddressEn = 0;
  let showFromAddress = false;
  let inputToAddressFlag = false;
  let inputToAddressFirstFlag = false;
  let toAddressSt = 0, toAddressEn = 0;
  let showToAddress = false;

  document.querySelector(".sm-preform__postcodeFrom").addEventListener("input", function(e) {
    e.preventDefault();
    let value = e.target.value;
    if(manual_addressFrom == false){
      document.querySelector(".addressesFromSet").style.display = "none";
      if(showFromAddress == true){  
        document.querySelector(".sm-preform__postcodeFrom").value = value.substring(value.length - 1, value.length);
        value1 = value.substring(value.length - 1, value.length);
        value = value1;
        showFromAddress = false;
      }
    
      if(value.length==0 || inputFromAddressFlag == false || (inputFromAddressFirstFlag == true && value.length < fromAddressSt)){
        inputFromAddressFlag = false;
        inputFromAddressFirstFlag = false;
        if (value != "") {
          fetch(`https://api.postcodes.io/postcodes/${value}`, {
            method: "GET",
            mode: "cors",
            headers: {"Content-Type": "application/json",},
          })
          .then((res) => res.json())
          .then((outcome) => {
            if (outcome.status == 200) {
              postcodeFrom_error = "";
              document.querySelector(".postcodeFrom-error").innerHTML = postcodeFrom_error;
              address_loading = true;
              valid_postcodeFrom = true;
              postcodeFrom = value;
              fetch(`https://www.slothmover.co.uk:8443/addresses/fetch?postcode=${postcodeFrom}`,{
                method: "GET",
                headers: {
                  Accept: "application/json",
                  "Content-Type": "application/json",
                  "Access-Control-Allow-Origin": "*",
                  "x-api-key": "SJCGoP8U0b2P5v5s5gGXh4dZBis1ZDuV5IPwqixl",
                },
              })
              .then((res) => res.json())
              .then((data) => {
                addressesFrom=[];
                data.forEach((adr) => {
                  let address = "";

                  for (let i = 0; i < adr.address.length; i++) {
                    if (i == adr.address.length - 1) {
                      address = address + adr.address[i];
                    } else {
                      address = address + adr.address[i] + ", ";
                    }
                  }
                  addressesFrom.push(address);
                });
                if(addressesFrom.length > 0){
                  document.querySelector(".addressesFromSet").style.display = "block";
                  inputFromAddressFlag = true;
                  inputFromAddressFirstFlag = true;
                  fromAddressSt = value.length;
                  addressesFrom.sort(function(a, b){
                    return a.localeCompare(b);
                  })
                }
                else{
                  document.querySelector(".addressesFromSet").style.display = "none";
                }
                var x =document.getElementById("addressesFromSet");
                var str = ""
                addressesFrom.forEach((adr) => {
                  str = str +  ("<div class = \"addressesFromItem\" onclick = \"addressesFromItemClick('" + adr + "')\">" + adr + "</div>");
                });
                x.innerHTML = str;
              });
            } else {
              postcodeFrom_error = "Sorry! This is not a valid postcode";
              document.querySelector(".postcodeFrom-error").innerHTML = postcodeFrom_error;
              show_addressesFrom = false;
              address_loadingFrom = false;
              valid_postcodeFrom = false;
              new_addressFrom = '';
            }
          });
        } else {
          document.querySelector(".postcodeFrom-error").innerHTML = "";
        }
      }
      else{
   
        if(inputFromAddressFirstFlag == true){
          document.querySelector(".sm-preform__postcodeFrom").value = value.substring(value.length - 1, value.length);
          value1 = value.substring(value.length - 1, value.length);
          value = value1;
          inputFromAddressFirstFlag = false;
        }
        //fromAddressEn = value.length;
        //let searchText = value.substring(fromAddressSt, fromAddressEn);
        searchText = value; 
        document.querySelector(".addressesFromSet").style.display = "block";
        if(searchText != ""){
          var x =document.getElementById("addressesFromSet");
          var str = ""
          addressesFrom.forEach((adr) => {
            var flag = adr.includes(searchText);
            if(flag == true){
              str = str +  ("<div class = \"addressesFromItem\" onclick = \"addressesFromItemClick('" + adr + "')\">" + adr + "</div>");
            }
          });
          x.innerHTML = str;
        }
      }
    }
    else{
      new_addressFrom = value;
    }  
  });
  function addressesFromItemClick(value){
    document.querySelector(".addressesFromSet").style.display = "none";
    new_addressFrom = value;
    //var str = document.querySelector(".sm-preform__postcodeFrom").value.substring(0, fromAddressSt) + " , " + value;
    document.querySelector(".sm-preform__postcodeFrom").value = value;
    showFromAddress = true;
    inputFromAddressFlag = false;
  }
  document.querySelector(".sm-preform__postcodeTo").addEventListener("input", function(e) {
    e.preventDefault();
    let value = e.target.value;
    if(manual_addressFrom == false){
      document.querySelector(".addressesToSet").style.display = "none";
      if(showToAddress == true){  
        document.querySelector(".sm-preform__postcodeTo").value = value.substring(value.length - 1, value.length);
        value1 = value.substring(value.length - 1, value.length);
        value = value1;
        showToAddress = false;
      }
      //if(value.length < 5)  inputToAddressFlag = false;
      if(value.length==0 || inputToAddressFlag == false || (inputToAddressFirstFlag == true && value.length < toAddressSt)){
        inputToAddressFlag = false;
        inputToAddressFirstFlag = false;
        if (value != "") {
          fetch(`https://api.postcodes.io/postcodes/${value}`, {
            method: "GET",
            mode: "cors",
            headers: {
              "Content-Type": "application/json",
            },
          })
          .then((res) => res.json())
          .then((outcome) => {
            if (outcome.status == 200) {
              postcodeTo_error = "";
              document.querySelector(".postcodeTo-error").innerHTML = postcodeTo_error;
              address_loading = true;
              valid_postcodeTo = true;
              postcodeTo = value;
              outcode = outcome.result.outcode;
              fetch(`https://www.slothmover.co.uk:8443/addresses/fetch?postcode=${postcodeTo}`,
              {
                method: "GET",
                headers: {
                  Accept: "application/json",
                  "Content-Type": "application/json",
                  "Access-Control-Allow-Origin": "*",
                  "x-api-key": "SJCGoP8U0b2P5v5s5gGXh4dZBis1ZDuV5IPwqixl",
                },
              })
              .then((res) => res.json())
              .then((data) => {
                addressesTo=[];
                data.forEach((adr) => {
                  let address = "";
                  for (let i = 0; i < adr.address.length; i++) {
                    if (i == adr.address.length - 1) {
                      address = address + adr.address[i];
                    } else {
                      address = address + adr.address[i] + ", ";
                    }
                  }
                  addressesTo.push(address);
                });
                if(addressesTo.length > 0){
                  document.querySelector(".addressesToSet").style.display = "block";
                  inputToAddressFlag = true;
                  inputToAddressFirstFlag = true;
                  toAddressSt = value.length;
                  addressesTo.sort(function(a, b){
                    return a.localeCompare(b);
                  })
                }
                else{
                  document.querySelector(".addressesToSet").style.display = "none";
                }
                var x =document.getElementById("addressesToSet");
                var str = ""
                addressesTo.forEach((adr) => {
                  str = str +  ("<div class = \"addressesToItem\" onclick = \"addressesToItemClick(" + "'"+ adr +"'" + ")\">" + adr + "</div>");
                });
                x.innerHTML = str;
              });
            } else {
              postcodeTo_error = "Sorry! This is not a valid postcode";
              document.querySelector(".postcodeTo-error").innerHTML = postcodeTo_error;
              show_addressesTo = false;
              address_loadingTo = false;
              valid_postcodeTo = false;
              new_addressTo = ''
            }
          });
        } else {
          document.querySelector(".postcodeTo-error").innerHTML = "";
        }  
      }
      else{
        if(inputToAddressFirstFlag == true){
          document.querySelector(".sm-preform__postcodeTo").value = value.substring(value.length - 1, value.length);
          value1 = value.substring(value.length - 1, value.length);
          value = value1;
          inputToAddressFirstFlag = false;
        }
        
        //toAddressEn = value.length;
        let searchText = value;
        document.querySelector(".addressesToSet").style.display = "block";
        if(searchText != ""){
          var x =document.getElementById("addressesToSet");
          var str = ""
          addressesTo.forEach((adr) => {
            var flag = adr.includes(searchText);
            if(flag == true){
              str = str +  ("<div class = \"addressesToItem\" onclick = \"addressesToItemClick('" + adr + "')\">" + adr + "</div>");
            }
          });
          x.innerHTML = str;
        }
      }
    }
    else{
      new_addressTo = value;
    } 
  });
  function addressesToItemClick(value){
    document.querySelector(".addressesToSet").style.display = "none";
    new_addressTo = value;
    //var str = document.querySelector(".sm-preform__postcodeTo").value.substring(0, toAddressSt) + " , " + value;
    document.querySelector(".sm-preform__postcodeTo").value = value;
    showToAddress = true;
    inputToAddressFlag = false;
  }
  document.querySelector(".desktop-view").addEventListener("submit", function(e) {
    e.preventDefault();
    if(manual_addressFrom == true && new_addressFrom != '' && new_addressTo !=''){
      var smfEmail = document.querySelector('input[name="smfEmail"]').value;
      var re = new RegExp(/^.*\//);
      document.location.href ="https://form.slothmove.com/?smfNewPostcode=" +
        postcodeTo +
        "&smfPrevPostcode=" +
        postcodeFrom +
        "&smfOutcode=" +
        outcode +
        "&smfNewAddress=" +
        new_addressTo +
        "&smfPrevAddress=" +
        new_addressFrom +
        "&smfEmail=" +
        smfEmail;
    }
    else if (postcodeTo_error == '' && postcodeFrom_error =='') {
      var smfEmail = document.querySelector('input[name="smfEmail"]').value;
      var re = new RegExp(/^.*\//);
      document.location.href ="https://form.slothmove.com/?smfNewPostcode=" +
        postcodeTo +
        "&smfPrevPostcode=" +
        postcodeFrom +
        "&smfOutcode=" +
        outcode +
        "&smfNewAddress=" +
        new_addressTo +
        "&smfPrevAddress=" +
        new_addressFrom +
        "&smfEmail=" +
        smfEmail;
    }
  })
  function enterAddressManuallyButtonClick(){
    enterAddressManuallyMobileButtonClick();
    document.querySelector(".sm-preform-enter-address-manually-button").style.display = "none";
    document.querySelector(".sm-preform-use-address-finder-button").style.display = "block";
    document.querySelector(".addressesFromSet").style.display = "none";
    document.querySelector(".addressesToSet").style.display = "none";
    document.querySelector(".postcodeTo-error").style.display = "none";
    document.querySelector(".postcodeFrom-error").style.display = "none";
    new_addressFrom = document.querySelector(".sm-preform__postcodeFrom").value;
    new_addressTo = document.querySelector(".sm-preform__postcodeTo").value; 
    manual_addressTo = true;
    manual_addressFrom = true;
  }
  function useAddressFinderButtonClick(){
    useAddressFinderMobileButtonClick();
    document.querySelector(".sm-preform-enter-address-manually-button").style.display = "block";
    document.querySelector(".sm-preform-use-address-finder-button").style.display = "none";
    document.querySelector(".postcodeFrom-error").style.display = "block";
    document.querySelector(".postcodeTo-error").style.display = "block";
    document.querySelector(".sm-preform__postcodeFrom").value = new_addressFrom;
    document.querySelector(".sm-preform__postcodeTo").value = new_addressTo;
    manual_addressFrom = false;
    manual_addressTo = false;
  }

  window.onload = init;
  function init(){
    document.querySelector(".addressesToSet").style.display = "none";
    document.querySelector(".addressesFromSet").style.display = "none";
    document.querySelector(".addressesFromSet-mobile").style.display = "none";
    document.querySelector(".addressesToSet-mobile").style.display = "none";
    
    if(postcodeTo != "" && postcodeFrom != "" && new_addressTo != "" && new_addressFrom != ""){
      postcodeTo_error = '';
      postcodeFrom_error ='';
    }
  }

  document.querySelector(".sm-preform__postcodeFrom__mobile").addEventListener("input", function(e) {
    e.preventDefault();
    let value = e.target.value;
    if(manual_addressFrom == false){
      document.querySelector(".addressesFromSet-mobile").style.display = "none";
      if(showFromAddress == true){  
        document.querySelector(".sm-preform__postcodeFrom__mobile").value = value.substring(value.length - 1, value.length);
        value1 = value.substring(value.length - 1, value.length);
        value = value1;
        showFromAddress = false;
      }
      //if(value.length < 5)  inputFromAddressFlag = false;
      if(inputFromAddressFlag == false || (inputFromAddressFirstFlag == true && value.length < fromAddressSt)){
        inputFromAddressFirstFlag = false;
        inputFromAddressFlag = false;
        if (value != "") {
          fetch(`https://api.postcodes.io/postcodes/${value}`, {
            method: "GET",
            mode: "cors",
            headers: {"Content-Type": "application/json",},
          })
          .then((res) => res.json())
          .then((outcome) => {
            if (outcome.status == 200) {
              postcodeFrom_error = "";
              document.querySelector(".postcodeFrom-error-mobile").innerHTML = postcodeFrom_error;
              address_loading = true;
              valid_postcodeFrom = true;
              postcodeFrom = value;
              fetch(`https://www.slothmover.co.uk:8443/addresses/fetch?postcode=${postcodeFrom}`,{
                method: "GET",
                headers: {
                  Accept: "application/json",
                  "Content-Type": "application/json",
                  "Access-Control-Allow-Origin": "*",
                  "x-api-key": "SJCGoP8U0b2P5v5s5gGXh4dZBis1ZDuV5IPwqixl",
                },
              })
              .then((res) => res.json())
              .then((data) => {
                addressesFrom=[];
                data.forEach((adr) => {
                  let address = "";

                  for (let i = 0; i < adr.address.length; i++) {
                    if (i == adr.address.length - 1) {
                      address = address + adr.address[i];
                    } else {
                      address = address + adr.address[i] + ", ";
                    }
                  }
                  addressesFrom.push(address);
                });
                if(addressesFrom.length > 0){
                  document.querySelector(".addressesFromSet-mobile").style.display = "block";
                  inputFromAddressFlag = true;
                  fromAddressSt = value.length;
                  inputFromAddressFirstFlag = true;
                  addressesFrom.sort(function(a, b){
                    return a.localeCompare(b);
                  })
                }
                else{
                  document.querySelector(".addressesFromSet-mobile").style.display = "none";
                }
                var x =document.getElementById("addressesFromSet-mobile");
                var str = ""
                addressesFrom.forEach((adr) => {
                  str = str +  ("<div class = \"addressesFromItem\" onclick = \"addressesFromMobileItemClick('" + adr + "')\">" + adr + "</div>");
                });
                x.innerHTML = str;
              });
            } else {
              postcodeFrom_error = "Sorry! This is not a valid postcode";
              document.querySelector(".postcodeFrom-error-mobile").innerHTML = postcodeFrom_error;
              show_addressesFrom = false;
              address_loadingFrom = false;
              valid_postcodeFrom = false;
              new_addressFrom = '';
            }
          });
        } else {
          document.querySelector(".postcodeFrom-error-mobile").innerHTML = "";
        }
      }
      else{
        //fromAddressEn = value.length;
        if(inputFromAddressFirstFlag == true){  
          document.querySelector(".sm-preform__postcodeFrom__mobile").value = value.substring(value.length - 1, value.length);
          value1 = value.substring(value.length - 1, value.length);
          value = value1;
          inputFromAddressFirstFlag = false;
        }
        let searchText = value;
        document.querySelector(".addressesFromSet-mobile").style.display = "block";
        if(searchText != ""){
          var x =document.getElementById("addressesFromSet-mobile");
          var str = ""
          addressesFrom.forEach((adr) => {
            var flag = adr.includes(searchText);
            if(flag == true){
              str = str +  ("<div class = \"addressesFromItem\" onclick = \"addressesFromMobileItemClick('" + adr + "')\">" + adr + "</div>");
            }
          });
          x.innerHTML = str;
        }
      }  
    }
    else{
      new_addressFrom = value;
    }
  });
  function addressesFromMobileItemClick(value){
    document.querySelector(".addressesFromSet-mobile").style.display = "none";
    new_addressFrom = value;
    //var str = document.querySelector(".sm-preform__postcodeFrom__mobile").value.substring(0, fromAddressSt) + " , " + value;
    document.querySelector(".sm-preform__postcodeFrom__mobile").value = value;
    showFromAddress = true;
    inputFromAddressFlag = false;
  }
  document.querySelector(".sm-preform__postcodeTo__mobile").addEventListener("input", function(e) {
    e.preventDefault();
    let value = e.target.value;
    if(manual_addressTo == false){
      document.querySelector(".addressesToSet-mobile").style.display = "none";
      if(showToAddress == true){  
        document.querySelector(".sm-preform__postcodeTo__mobile").value = value.substring(value.length - 1, value.length);
        value1 = value.substring(value.length - 1, value.length);
        value = value1;
        showToAddress = false;
      }
      //if(value.length < 5)  inputToAddressFlag = false;
      if(inputToAddressFlag == false || (inputToAddressFirstFlag = true && value.length < toAddressSt)){
        inputToAddressFirstFlag = false;
        inputToAddressFlag = false;
        if (value != "") {
          fetch(`https://api.postcodes.io/postcodes/${value}`, {
            method: "GET",
            mode: "cors",
            headers: {
              "Content-Type": "application/json",
            },
          })
          .then((res) => res.json())
          .then((outcome) => {
            if (outcome.status == 200) {
              postcodeTo_error = "";
              document.querySelector(".postcodeTo-error-mobile").innerHTML = postcodeTo_error;
              address_loading = true;
              valid_postcodeTo = true;
              postcodeTo = value;
              outcode = outcome.result.outcode;
              fetch(`https://www.slothmover.co.uk:8443/addresses/fetch?postcode=${postcodeTo}`,
              {
                method: "GET",
                headers: {
                  Accept: "application/json",
                  "Content-Type": "application/json",
                  "Access-Control-Allow-Origin": "*",
                  "x-api-key": "SJCGoP8U0b2P5v5s5gGXh4dZBis1ZDuV5IPwqixl",
                },
              })
              .then((res) => res.json())
              .then((data) => {
                addressesTo=[];
                data.forEach((adr) => {
                  let address = "";
                  for (let i = 0; i < adr.address.length; i++) {
                    if (i == adr.address.length - 1) {
                      address = address + adr.address[i];
                    } else {
                      address = address + adr.address[i] + ", ";
                    }
                  }
                  addressesTo.push(address);
                });
                if(addressesTo.length > 0){
                  document.querySelector(".addressesToSet-mobile").style.display = "block";
                  inputToAddressFlag = true;
                  inputToAddressFirstFlag = true;
                  toAddressSt = value.length;
                  addressesTo.sort(function(a, b){
                    return a.localeCompare(b);
                  })
                }
                else{
                  document.querySelector(".addressesToSet-mobile").style.display = "none";
                }
                var x =document.getElementById("addressesToSet-mobile");
                var str = ""
                addressesTo.forEach((adr) => {
                  str = str +  ("<div class = \"addressesToItem\" onclick = \"addressesToMobileItemClick(" + "'"+ adr +"'" + ")\">" + adr + "</div>");
                });
                x.innerHTML = str;
              });
            } else {
              postcodeTo_error = "Sorry! This is not a valid postcode";
              document.querySelector(".postcodeTo-error-mobile").innerHTML = postcodeTo_error;
              show_addressesTo = false;
              address_loadingTo = false;
              valid_postcodeTo = false;
              new_addressTo = ''
            }
          });
        } else {
          document.querySelector(".postcodeTo-error-mobile").innerHTML = "";
        }
      }
      else{
        toAddressEn = value.length;
        if(inputToAddressFirstFlag == true){  
          document.querySelector(".sm-preform__postcodeTo__mobile").value = value.substring(value.length - 1, value.length);
          value1 = value.substring(value.length - 1, value.length);
          value = value1;
          inputToAddressFirstFlag = false;
        }
        let searchText = value;
        document.querySelector(".addressesToSet-mobile").style.display = "block";
        if(searchText != ""){
          var x =document.getElementById("addressesToSet-mobile");
          var str = ""
          addressesTo.forEach((adr) => {
            var flag = adr.includes(searchText);
            if(flag == true){
              str = str +  ("<div class = \"addressesToItem\" onclick = \"addressesToMobileItemClick('" + adr + "')\">" + adr + "</div>");
            }
          });
          x.innerHTML = str;
        }
      }
    }
    else{
      addressesTo = value;
    }
  });
  
  function addressesToMobileItemClick(value){
    document.querySelector(".addressesToSet-mobile").style.display = "none";
    new_addressTo = value;
    //var str = document.querySelector(".sm-preform__postcodeTo__mobile").value.substring(0, toAddressSt) + " , " + value;
    document.querySelector(".sm-preform__postcodeTo__mobile").value = value;
    showToAddress = true;
    inputToAddressFlag = false;
  }
  
  document.querySelector(".mobile-view").addEventListener("submit", function(e) {
    e.preventDefault();
    if(manual_addressFrom == true && new_addressFrom != '' && new_addressTo !=''){
      var smfEmail = document.querySelector('input[name="smfEmailMobile"]').value;
      var re = new RegExp(/^.*\//);
      document.location.href ="https://form.slothmove.com/?smfNewPostcode=" +
        postcodeTo +
        "&smfPrevPostcode=" +
        postcodeFrom +
        "&smfOutcode=" +
        outcode +
        "&smfNewAddress=" +
        new_addressTo +
        "&smfPrevAddress=" +
        new_addressFrom +
        "&smfEmail=" +
        smfEmail;
    }
    else if (postcodeTo_error == '' && postcodeFrom_error =='') {
      var smfEmail = document.querySelector('input[name="smfEmailMobile"]').value;
      var re = new RegExp(/^.*\//);
      document.location.href ="https://form.slothmove.com/?smfNewPostcode=" +
        postcodeTo +
        "&smfPrevPostcode=" +
        postcodeFrom +
        "&smfOutcode=" +
        outcode +
        "&smfNewAddress=" +
        new_addressTo +
        "&smfPrevAddress=" +
        new_addressFrom +
        "&smfEmail=" +
        smfEmail;
      
    }
  })
  function enterAddressManuallyMobileButtonClick(){
    document.querySelector(".sm-preform-enter-address-manually-button-mobile").style.display = "none";
    document.querySelector(".sm-preform-use-address-finder-button-mobile").style.display = "block";
    document.querySelector(".addressesFromSet-mobile").style.display = "none";
    document.querySelector(".addressesToSet-mobile").style.display = "none";
    document.querySelector(".postcodeTo-error-mobile").style.display = "none";
    document.querySelector(".postcodeFrom-error-mobile").style.display = "none";
    new_addressFrom = document.querySelector(".sm-preform__postcodeFrom__mobile").value;
    new_addressTo = document.querySelector(".sm-preform__postcodeTo__mobile").value; 
    manual_addressTo = true;
    manual_addressFrom = true;

    document.querySelector(".sm-preform-enter-address-manually-button").style.display = "none";
    document.querySelector(".sm-preform-use-address-finder-button").style.display = "block";
    document.querySelector(".addressesFromSet").style.display = "none";
    document.querySelector(".addressesToSet").style.display = "none";
    document.querySelector(".postcodeTo-error").style.display = "none";
    document.querySelector(".postcodeFrom-error").style.display = "none";
  }
  function useAddressFinderMobileButtonClick(){
    document.querySelector(".sm-preform-enter-address-manually-button-mobile").style.display = "block";
    document.querySelector(".sm-preform-use-address-finder-button-mobile").style.display = "none";
    document.querySelector(".postcodeFrom-error-mobile").style.display = "block";
    document.querySelector(".postcodeTo-error-mobile").style.display = "block";
    document.querySelector(".sm-preform__postcodeFrom__mobile").value = new_addressFrom;
    document.querySelector(".sm-preform__postcodeTo__mobile").value = new_addressTo;
    manual_addressFrom = false;
    manual_addressTo = false;

    document.querySelector(".sm-preform-enter-address-manually-button").style.display = "block";
    document.querySelector(".sm-preform-use-address-finder-button").style.display = "none";
    document.querySelector(".postcodeTo-error").style.display = "block";
    document.querySelector(".postcodeFrom-error").style.display = "block";
  }
</script>

    <style> 
      * {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .autocomplete {
        position: relative;
        display: inline-block;
        width: 100%;
      }

      .loader {
        border: 5px solid #daddd8;
        border-top: 5px solid #18a8d6;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
        position: absolute;
        right: -10px;
        top: 0;
        display: none;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .formDiv {
        color: #05547d;
        font-size: 15px;
        margin-top: 10px;
        text-align: right;
        width: calc(100% + 13px);
      }
      .no-results {
        color: #05547d;
      }
      .formSwitch {
        cursor: pointer;
      }

      .manualAddress {
        display: none;
      }

      .autocomplete-items {
        position: absolute;
        border: 1px solid #d4d4d4;
        border-bottom: none;
        border-top: none;
        z-index: 99;
        /*position the autocomplete items to be the same width as the container:*/
        top: 100%;
        left: 0;
        right: 0;
        width: calc(100%);
        max-height: 300px;
        overflow-y: scroll;
        border-bottom: 1px solid #d4d4d4;
      }

      .error {
        margin-top: 5px;
        color: red;
        font-size: 13px;
        margin-bottom: 0;
      }

      .autocomplete-items div {
        padding: 10px;
        cursor: pointer;
        background-color: #fff;
        border-bottom: 1px solid #d4d4d4;
      }

      .autocomplete-items div:hover {
        background-color: #e9e9e9;
      }

      .sm-preform {
        margin: 0 auto;
        display: flex;
        justify-content: center;
        font-family: "Montserrat", sans-serif !important;
        min-height: 350px;
        background: #fff;
        width: 940px;
        padding: 5px 30px 20px;
        font-family: 'montserat';
        font-size: 16px;
        border-radius: 15px;
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
        padding-bottom: 0px;
      }

      .sm-preform__label {
        color: #21739e;
        font-family: "Montserrat", sans-serif;
        font-weight: 700;
        margin-top: 15px;
        margin-bottom: 5px;
      }

      .sm-preform__input {
        padding: 10px 13px;
        font-family: Montserrat, sans-serif !important;
        font-size: 17px;
        margin: 0;
        height: 54px;
        border: 2px solid #949494 !important;
        color: #131313 !important;
        border-radius: 5px;
        padding-left: 15px;
        outline: none;
      }

      .autocomplete-items {
        font-family: Montserrat, sans-serif !important;
      }

      .sm-preform_checkbox {
        padding-top: 10px;
        padding-bottom: 20px;
      }
      .sm-preform__submit {
        cursor: pointer;
        font-family: "Montserrat", sans-serif;
        font-weight: 500;
        color: #fff;
        letter-spacing: 0.5px;
        border: 0;
        border-radius: 5px;
        background: #FF5757;
        transition: all 0.25s ease;
        font-size: 16px;
        height: 54px;
        width: 48%;
      }

      .sm-preform__submit:hover {
        background-color: #E13030;
      }
      .sm-preform__check {
        display: inline;
        margin-right: 2px;
        cursor: pointer;
      }

      .sm-preform__check-lbl {
        line-height: 1;
        font-size: 0.75em;
        display: inline;
      }

      .sm-preform__error {
        color: red;
        margin-top: 15px;
        display: none;
      }

      .sm-addressesTo {
        display: none;
        flex-direction: column;
      }
      .sm-addressesFrom {
        display: none;
        flex-direction: column;
      }
      .suppliers-loading-pre {
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .suppliers-loading-pre p {
        margin-top: 30px;
      }
      .loader2-pre {
        border: 5px solid #daddd8;
        border-top: 5px solid #18a8d6;
        border-radius: 50%;
        width: 70px;
        height: 70px;
        -webkit-animation: spin 2s linear infinite;
        animation: spin 2s linear infinite;
        margin-top: 30px;
      }
      .smf-logo-spinner-pre {
        height: 50px;
        object-fit: contain;
        margin-top: -70px;
      }
   
  .automatic_find{
    font-weight: 700;
    cursor: pointer;
    color: #18a8d6;
  }

  .manual_switchTo{
    cursor: pointer;
    margin-left: auto;
    color: #21739e;
    margin-top: 10px;
  }
  .manual_switchFrom{
    cursor: pointer;
    margin-left: auto;
    color: #21739e;
    margin-top: 10px;
  }
  .manual_divTo{
    display:none;
  }
  .manual_divFrom{
    display:none;
  }
  .sm-preform-left{
    width: 60%;
  }
  .sm-preform-left-title{
    font-size: 28px;
    font-weight: 500;
    line-height: 1.3;
    padding-top: 15px;
  }
  .sm-preform-left-content{
    padding-top: 5px;
    font-size: 20px;
    color: #545454;
  }
  .sm-preform-left-inputs{
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
  }
  .sm-preform-right{
    display: flex;
    justify-content: center;
    align-items: center;
    padding-left: 25px;
  }
  .sm-preform-input-email-padding{
    margin-top:15px;
  }
  .sm-preform-input-email-width{
    width: 100%;
  }
  .sm-preform-input-postcode-width{
    width: 238px;
  }
  .sm-preform-left-buttons{
    margin-top: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
  }
  .sm-preform-left-buttons-trustpilot{
    display:flex;
    justify-content: space-between;
  }
  .sm-preform-left-buttons-trustpilot-content{
    display: flex;
    align-items: center;
    font-size: 13px;
  }
  .sm-preform-left-buttons-trustpilot-icon{
    margin-bottom: 4px;
  }
  .sm-preform-address-set{
    display: flex;
    justify-content: space-between;
  }
  .sm-preform-enter-address-manually-part{
    display: flex;
    justify-content: end;
    margin-bottom: 20px;
    font-size: 14px;
  }
  .sm-preform-enter-address-manually-button{
    display: block;
    text-decoration: underline;
    cursor: pointer;
  }
  .sm-preform-use-address-finder-button{
    display: none;
    text-decoration: underline;
    cursor: pointer;
  }
  .addressesFromSet{
    margin-top: -5px;
    cursor: pointer;
    color: #545454;
    position: absolute;
    background: white;
    width: 237px;
    line-height: 1.25;
    padding-left: 13px;
    font-size: 14px;
    height: 135px;
    overflow: hidden;
    overflow-y: scroll;
    border: 2px solid #d4d4d4;
    border-radius: 5px;
  }
  .addressesFromItem{
    padding-top: 3px;
    padding-bottom: 3px;
  }
  .addressesFromItem:hover {
    color: black;
  }
  .addressesToSet{
    margin-top: -5px;
    cursor: pointer;
    color: #545454;
    position: absolute;
    background: white;
    width: 237px;
    line-height: 1.25;
    margin-left: 251px;
    padding-left: 13px; 
    font-size: 14px;
    height: 135px;
    overflow: hidden;
    overflow-y: scroll;
    border: 2px solid #d4d4d4;
    border-radius: 5px;
  }
  .addressesToItem{
    padding-top: 3px;
    padding-bottom: 3px;
  }
  .addressesToItem:hover {
    color: black;
  }
  @media only screen and (min-width: 1000px){
    .desktop-view{
      display: block;
    }
    .mobile-view{
      display: none;
    }
  }
  @media only screen and (max-width: 1000px){
    .desktop-view{
      display: none;
    }
    .mobile-view{
      display: block;
    }
  }
  .sm-preform-mobile{
    margin: 0 auto;
    font-family: "Montserrat", sans-serif !important;
    min-height: 820px;
    background: #fff;
    width: 350px;
    padding: 5px 30px 20px;
    font-family: 'montserat';
    font-size: 16px;
    border-radius: 15px;
    box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
    padding-bottom: 0px;
  }
  .sm-preform-mobile-logo{
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .sm-preform-mobile-title{
    width: 98%;
    margin-left: 10px;
    font-size: 24px;
    font-weight: 500;
  }
  .sm-preform-mobile-content{
    width: 98%;
    margin-left: 10px;
    margin-top: 10px;
    font-size: 16px;
    color: #545454;
  }
  .sm-preform-mobile-input{
    margin-left: 10px;
    margin-top: 15px;
  }
  .sm-preform-mobile-email-input-width{
    width: 98%;
  }
  .addressesFromSet-mobile{
    margin-left: 10px;
    margin-top: -5px;
    cursor: pointer;
    color: #545454;
    position: absolute;
    background: white;
    width: 275px;
    line-height: 1.25;
    padding-left: 13px;
    font-size: 14px;
    height: 135px;
    overflow: hidden;
    overflow-y: scroll;
    border: 2px solid #d4d4d4;
    border-radius: 5px;
    z-index: 10;
  }
  .addressesToSet-mobile{
    margin-left: 10px;
    margin-top: -5px;
    cursor: pointer;
    color: #545454;
    position: absolute;
    background: white;
    width: 275px;
    line-height: 1.25;
    padding-left: 13px;
    font-size: 14px;
    height: 135px;
    overflow: hidden;
    overflow-y: scroll;
    border: 2px solid #d4d4d4;
    border-radius: 5px;
  }
  .sm-preform__submit-mobile {
    margin-left: 10px;
    margin-top: 15px;
    cursor: pointer;
    font-family: "Montserrat", sans-serif;
    font-weight: 500;
    color: #fff;
    letter-spacing: 0.5px;
    border: 0;
    border-radius: 5px;
    background: #FF5757;
    transition: all 0.25s ease;
    font-size: 18px;
    height: 54px;
    width: 275px;
  }

  .sm-preform__submit-mobile:hover {
    background-color: #E13030;
  }
  .sm-preform-trustpilot-mobile{
    margin-top: 20px;
    padding-bottom: 25px;
    display: flex;
    justify-content: center;
  }
  .sm-preform-trustpilot-mobile-width{
    width: 50%;
  }
  .sm-preform-left-buttons-trustpilot-content-mobile{
    display: flex;
    align-items: center;
    font-size: 13px;
    color: #545454;
  }
  .sm-preform-enter-address-manually-part-mobile{
    margin-top: 10px;
    margin-bottom: 20px;
    font-size: 14px;
  }
  .sm-preform-enter-address-manually-button-mobile{
    margin-left: 115px;
    display: block;
    text-decoration: underline;
    cursor: pointer;
  }
  .sm-preform-use-address-finder-button-mobile{
    margin-left: 148px;
    display: none;
    text-decoration: underline;
    cursor: pointer;
  }
</style>
